{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'projects/css/projects.css' %}">
<link rel="stylesheet" href="{% static 'projects/css/projects-actions.css' %}">

<style>
  .page-top-grid {
  display: flex;
  gap: 24px;
  align-items: flex-start;
  flex-wrap: nowrap;
}
/* ---- Mapping panel: equal-width columns and professional styling ---- */
.mapping-card {
  margin-top: 20px;
  border-radius: 12px;
  background: linear-gradient(180deg, #ffffff, #fbfdff);
  border: 1px solid rgba(15,23,42,0.04);
  box-shadow: 0 8px 24px rgba(16,24,40,0.06);
  padding: 18px;
}
.mapping-header { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
.mapping-title { font-weight:700; font-size:16px; margin-bottom:6px; }
.mapping-sub { color:#6b7280; font-size:13px; margin-bottom:12px; }

.mapping-grid {
  display:flex;
  gap:20px;
  align-items:flex-start;
  flex-wrap:wrap;
}

/* Make both columns equal width and avoid horizontal overflow */
.mapping-left{
  flex: 1 1 0;
  min-width: 0;           /* essential to allow flex children to shrink */
  max-height: 360px;
  overflow-y: auto;
}

/* Left project list */
.project-list { list-style:none; padding:8px; margin:0; border-radius:8px; border:1px solid rgba(15,23,42,0.04); }
.project-item { padding:12px; border-radius:8px; background:#fff; margin-bottom:8px; display:flex; gap:10px; align-items:center; box-shadow: 0 1px 0 rgba(15,23,42,0.02); }
.project-item .meta { font-size:13px; color:#6b7280; }

/* Right COE list */
/* Fix COE table layout so names span full width */
.mapping-right {
  flex: 1 1 0;
  min-width: 0;
}

.coe-table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto; /* let columns size naturally */
}

.coe-table thead th {
  padding: 10px 12px;
  text-align: left;
  font-weight: 700;
  border-bottom: 1px solid rgba(15,23,42,0.06);
}

.coe-table tbody {
  display: table-row-group; /* restore normal flow */
  max-height: unset;        /* no artificial limit */
  overflow: visible;
}

.coe-table td {
  padding: 10px 12px;
  vertical-align: middle;
  word-break: break-word;   /* long names wrap nicely */
}}
.coe-checkbox { transform:scale(1.06); }

/* filter/search & select all */
.coe-filter { width:260px; padding:8px 10px; border-radius:8px; border:1px solid rgba(15,23,42,0.06); }
.select-all-label { display:inline-flex; align-items:center; gap:8px; color:#374151; font-size:14px; margin-right:12px; }

/* Buttons and toast */
.mapping-controls { display:flex; justify-content:flex-end; gap:10px; margin-top:12px; }
.status-toast {
  position: fixed;
  right: 28px;
  top: 96px;
  z-index: 99999;
  min-width: 280px;
  padding: 12px 16px;
  border-radius: 10px;
  font-weight: 700;
  box-shadow: 0 8px 24px rgba(15,23,42,0.12);
}

/* Responsive */
@media (max-width: 920px) {
  .mapping-grid { flex-direction:column; }
  .mapping-left, .mapping-right { width:100%; max-height:280px; }
}
  .coe-tree {
  margin-top: 18px;
  border-radius: 10px;
  border: 1px solid rgba(15,23,42,0.06);
  background: #fff;
  box-shadow: 0 4px 14px rgba(15,23,42,0.04);
  padding: 12px 14px;
  max-height: 420px;
  overflow-y: auto;
}
.coe-item {
  margin-bottom: 10px;
}
.coe-header {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 700;
  font-size: 14px;
  cursor: pointer;
  padding: 6px 4px;
  border-radius: 6px;
  transition: background 0.2s;
}
.coe-header:hover { background: rgba(37,99,235,0.06); }
.coe-header .chevron {
  font-size: 12px;
  transition: transform 0.2s;
}
.coe-header.collapsed .chevron { transform: rotate(-90deg); }

.domain-list {
  margin-left: 20px;
  margin-top: 6px;
  display: none;
}
.domain-list.active { display: block; }

.domain-item {
  padding: 4px 6px;
  font-size: 13px;
  color: #374151;
  border-left: 2px solid rgba(37,99,235,0.2);
  margin-bottom: 4px;
}
.domain-item:hover { background: rgba(37,99,235,0.04); border-radius: 4px; }
</style>
{% endblock %}

{% block content %}

<div style="display:flex; gap:28px; align-items:flex-start; flex-wrap:wrap;">

  <!-- LEFT: Create Project form -->
  <div style="flex:0 0 640px; min-width:320px;">
    <div class="panel" style="padding:26px;">
      <h2>Create Project</h2>

      {% if error %}
        <div role="alert" style="color:#b91c1c;margin-bottom:12px;font-weight:700">{{ error }}</div>
      {% endif %}

      <form method="post" id="createProjectForm" novalidate>
        {% csrf_token %}
        <label>
          <div class="label-title">Project Name</div>
          <input type="text" name="name" id="proj_name_input" required class="form-input" placeholder="Enter project name" />
        </label>

        <label>
          <div class="label-title">Description</div>
          <textarea name="description" id="proj_desc_input" rows="4" class="form-input" placeholder="Short description"></textarea>
        </label>

        <div style="display:flex; gap:12px;">
          <label style="flex:1">
            <div class="label-title">Start Date</div>
            <input type="date" name="start_date" id="proj_start_date" class="form-input" />
          </label>
          <label style="flex:1">
            <div class="label-title">End Date</div>
            <input type="date" name="end_date" id="proj_end_date" class="form-input" />
          </label>
        </div>

        <label>
          <div class="label-title">Program Development Lead (PDL)</div>
          <input id="pdl_picker" name="pdl_display" type="text" class="form-input" placeholder="Type at least 3 chars to search LDAP..." autocomplete="off" />
          <input id="pdl_username" name="pdl_username" type="hidden" value="" />
          <div id="pdl_suggestions" class="autocomplete-list" aria-hidden="true"></div>
        </label>

        <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:14px;">
          <a href="{% url 'projects:list' %}" class="btn secondary">Cancel</a>
          <button type="submit" class="btn primary">Create Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- RIGHT: action panel -->
  <div style="flex:1; min-width:360px;">
    <div class="actions-panel" style="padding:18px;border-radius:10px;background:#fff;border:1px solid rgba(15,23,42,0.04);box-shadow:0 6px 18px rgba(16,24,40,0.03)">
      <h3>Project Actions</h3>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px;">
        <a href="#" class="btn-light" data-open="coeCreateModal">‚ûï Create COE</a>
        <a href="#" class="btn-light" data-open="coeListModal">‚úèÔ∏è Edit COE</a>
        <a href="#" class="btn-light" data-open="coeLeaderModal">üë§ Assign/Edit Leader</a>
        <a href="#" class="btn-light" data-open="domainCreateModal">üìÇ Create Domain</a>
        <a href="#" class="btn-light" data-open="domainEditModal">‚úèÔ∏è Edit Domain</a>
        <a href="{% url 'projects:list' %}" class="btn-light">üìë View Projects</a>
        <a href="#" class="btn-light" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">‚Ü• Back to Top</a>
        <a href="#" class="btn-light danger" data-open="projectDeleteModal">üóëÔ∏è Delete Project</a>
      </div>
    </div>
  </div>
</div>

<!-- ===================== MAPPING PANEL (below create form) ===================== -->
<div class="mapping-card" id="mappingCard" aria-label="Map COEs to a project">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <div>
      <div class="mapping-title">Assign COEs to a Project</div>
      <div class="mapping-sub">Select a project on the left (or choose "This new project"), then select COEs on the right. Click Save to persist mappings.</div>
    </div>

    <div style="display:flex; align-items:center; gap:12px;">
      <label class="select-all-label"><input type="checkbox" id="selectAllCoes"> Select all</label>
      <input id="coeFilterInput" class="coe-filter" placeholder="Filter COEs by name..." />
    </div>
  </div>

  <div class="mapping-grid" style="margin-top:12px;">
    <!-- Left: Project selector -->
    <div class="mapping-left">
      <div style="font-weight:600; margin-bottom:8px;">Project</div>
      <ul class="project-list" id="projectList">
        <li class="project-item">
          <label style="display:flex; gap:10px; align-items:center; width:100%;">
            <input type="radio" name="project_choice" value="new" id="project_choice_new" checked>
            <div>
              <div style="font-weight:700;">This new project</div>
              <div class="meta">Use the details from the form above to create a new project and map COEs to it.</div>
            </div>
          </label>
        </li>

        {% if projects %}
          {% for p in projects %}
            <li class="project-item">
              <label style="display:flex; gap:10px; align-items:center; width:100%;">
                <input type="radio" name="project_choice" value="{{ p.id }}" class="project-radio">
                <div>
                  <div style="font-weight:700;">{{ p.name }}</div>
                  <div class="meta">{% if p.mapped_coe_count %}{{ p.mapped_coe_count }} COEs mapped{% else %}No COEs mapped{% endif %}</div>
                </div>
              </label>
            </li>
          {% endfor %}
        {% endif %}
      </ul>
    </div>

    <!-- Right: COE list -->
    <div class="mapping-right">
      <div style="font-weight:600; margin-bottom:8px;">COEs</div>

      <div style="overflow-y:auto; max-height:320px; border:1px solid rgba(15,23,42,0.04); border-radius:8px;">
  <table class="coe-table" role="table" aria-label="COEs list">
    <thead>
      <tr>
        <th style="width:48px;"></th>
        <th>COE Name</th>
      </tr>
    </thead>
    <tbody id="coeTbody">
      {% if coes %}
        {% for coe in coes %}
          <tr data-coe-name="{{ coe.name|lower }}">
            <td style="width:48px;"><input type="checkbox" class="coe-checkbox" value="{{ coe.id }}"></td>
            <td>{{ coe.name }}</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr><td colspan="2" class="muted" style="padding:12px">No COEs available.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>

    </div>
  </div>

  <div class="mapping-controls">
    <button type="button" class="btn secondary" id="mappingClearBtn">Clear</button>
    <button type="button" class="btn primary" id="mappingSaveBtn">Save</button>
  </div>
</div>

<!-- ========================= MODALS (COEs / Domains / Leaders / Delete) ========================= -->
<!-- COE Create Modal -->
<div id="coeCreateModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeCreateTitle">
    <div class="modal-header">
      <span id="coeCreateTitle">Create COE</span>
      <button class="close-modal" data-close="coeCreateModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">COE Name</div>
        <input type="text" class="form-input" id="coe_name_input" placeholder="COE Name">
      </label>
      <label>
        <div class="label-title">Description</div>
        <textarea class="form-input" id="coe_desc_input" rows="3" placeholder="Short description"></textarea>
      </label>
      <label>
        <div class="label-title">COE Leader (optional)</div>
        <input id="coe_leader_picker" class="form-input" placeholder="Search user..." autocomplete="off">
        <input id="coe_leader_username" type="hidden">
        <div id="coe_leader_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeCreateModal">Cancel</button>
      <button class="btn primary" id="coeCreateSave">Save</button>
    </div>
  </div>
</div>

<!-- COE Edit Modal -->
<div id="coeListModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeEditTitle">
    <div class="modal-header">
      <span id="coeEditTitle">Edit COE</span>
      <button class="close-modal" data-close="coeListModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Select COE</div>
        <select class="form-input" id="coe_select">
          <option value="">-- Select COE --</option>
          {% if coes %}
            {% for coe in coes %}
              <option value="{{ coe.id }}">{{ coe.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </label>
      <label>
        <div class="label-title">Description</div>
        <textarea class="form-input" id="coe_edit_desc" rows="3"></textarea>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeListModal">Cancel</button>
      <button class="btn primary" id="coeUpdateBtn">Update</button>
    </div>
  </div>
</div>

<!-- Assign/Edit COE Leader Modal -->
<div id="coeLeaderModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeLeaderTitle">
    <div class="modal-header">
      <span id="coeLeaderTitle">Assign / Edit COE Leader</span>
      <button class="close-modal" data-close="coeLeaderModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Search User</div>
        <input id="leader_search_input" class="form-input" placeholder="Type at least 3 chars to search LDAP..." autocomplete="off">
        <input id="leader_username" type="hidden">
        <div id="leader_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
      <label>
        <div class="label-title">Select COE</div>
        <select class="form-input" id="coe_leader_select">
          <option value="">-- Select COE --</option>
          {% if coes %}
            {% for coe in coes %}
              <option value="{{ coe.id }}">{{ coe.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeLeaderModal">Cancel</button>
      <button class="btn primary" id="coeLeaderAssignBtn">Assign</button>
    </div>
  </div>
</div>

<!-- Domain Create Modal -->
<div id="domainCreateModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="domainCreateTitle">
    <div class="modal-header">
      <span id="domainCreateTitle">Create Domain</span>
      <button class="close-modal" data-close="domainCreateModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Domain Name</div>
        <input type="text" class="form-input" id="domain_name_input" placeholder="Domain Name">
      </label>
      <label>
        <div class="label-title">COE</div>
        <select class="form-input" id="domain_coe_select">
          <option value="">-- Select COE --</option>
          {% if coes %}
            {% for coe in coes %}
              <option value="{{ coe.id }}">{{ coe.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </label>
      <label>
        <div class="label-title">Domain Lead (optional)</div>
        <input id="domain_lead_picker" type="text" class="form-input" placeholder="Search user." autocomplete="off" />
        <input id="domain_lead_username" type="hidden">
        <div id="domain_lead_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="domainCreateModal">Cancel</button>
      <button class="btn primary" id="domainCreateSave">Save</button>
    </div>
  </div>
</div>

<!-- Domain Edit Modal -->
<div id="domainEditModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="domainEditTitle">
    <div class="modal-header">
      <span id="domainEditTitle">Edit Domain</span>
      <button class="close-modal" data-close="domainEditModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Select Domain</div>
        <select class="form-input" id="domain_select">
          <option value="">-- Select Domain --</option>
          {% if domains %}
            {% for d in domains %}
              <option value="{{ d.id }}" data-coe="{{ d.coe_id|default:'' }}">{{ d.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </label>
      <label>
        <div class="label-title">Domain Lead</div>
        <input id="domain_edit_lead_picker" class="form-input" placeholder="Search user." autocomplete="off">
        <input id="domain_edit_lead_username" type="hidden">
        <div id="domain_edit_lead_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="domainEditModal">Cancel</button>
      <button class="btn primary" id="domainUpdateBtn">Update</button>
    </div>
  </div>
</div>

<!-- Project Delete Modal -->
<div id="projectDeleteModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="projectDeleteTitle">
    <div class="modal-header">
      <span id="projectDeleteTitle">Delete Project</span>
      <button class="close-modal" data-close="projectDeleteModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete the selected project? This action cannot be undone.</p>
      <label>
        <div class="label-title">Project</div>
        <select class="form-input" id="project_delete_select">
          <option value="">-- Select project --</option>
          {% if projects %}
            {% for p in projects %}
              <option value="{{ p.id }}">{{ p.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="projectDeleteModal">Cancel</button>
      <button class="btn primary" id="projectDeleteConfirm">Delete</button>
    </div>
  </div>
</div>
<!-- NEW: COE + Domain tree -->
    <div class="coe-tree">
      <h3 style="margin:0 0 12px 0;font-size:16px;font-weight:700;color:#0b1320;">COEs & Domains</h3>
      {% if coes %}
        {% for coe in coes %}
          <div class="coe-item">
            <div class="coe-header collapsed" onclick="this.classList.toggle('collapsed');this.nextElementSibling.classList.toggle('active');">
              <span class="chevron">‚ñ∂</span> {{ coe.name }}
            </div>
            <div class="domain-list">
              {% for d in domains %}
                {% if d.coe_id == coe.id %}
                  <div class="domain-item">üìÇ {{ d.name }}</div>
                {% endif %}
              {% empty %}
                <div class="domain-item muted">No domains</div>
              {% endfor %}
            </div>
          </div>
        {% endfor %}
      {% else %}
        <div class="muted" style="font-size:14px;color:#6b7280;">No COEs available yet.</div>
      {% endif %}
    </div>


{% block extra_js %}
<!-- main actions JS (preserves existing behavior). Ensure your static file exists. -->
<script src="{% static 'projects/js/projects-actions.js' %}"></script>

<!-- Inline mapping logic: works with the equal-width layout -->
<script>
(function(){
  function getCookie(name){ const v=document.cookie.match('(^|;)\\s*'+name+'\\s*=\\s*([^;]+)'); return v? v.pop() : ''; }
  const csrftoken = getCookie('csrftoken');

  function showStatus(message, ok=true, timeout=3500){
    let box = document.getElementById('statusToast');
    if(!box){ box = document.createElement('div'); box.id='statusToast'; box.className='status-toast'; document.body.appendChild(box); }
    box.textContent = message;
    if(ok){
      box.style.background = 'linear-gradient(90deg,#ecfdf5,#ecfeef)';
      box.style.color = '#065f46';
      box.style.border = '1px solid rgba(6,95,70,0.08)';
    } else {
      box.style.background = 'linear-gradient(90deg,#fff1f2,#fff5f6)';
      box.style.color = '#7f1d1d';
      box.style.border = '1px solid rgba(127,29,29,0.06)';
    }
    clearTimeout(box._t); box._t = setTimeout(()=>{ try{ box.remove(); }catch(e){} }, timeout);
  }

  const coeFilter = document.getElementById('coeFilterInput');
  const coeTbody = document.getElementById('coeTbody');
  const selectAll = document.getElementById('selectAllCoes');
  const mappingClearBtn = document.getElementById('mappingClearBtn');
  const mappingSaveBtn = document.getElementById('mappingSaveBtn');

  function updateSelectAllState(){
    if(!selectAll) return;
    const visible = Array.from(document.querySelectorAll('#coeTbody tr')).filter(r => r.style.display !== 'none');
    if(visible.length === 0){ selectAll.checked = false; return; }
    selectAll.checked = visible.every(r => !!r.querySelector('.coe-checkbox')?.checked);
  }

  if(coeFilter && coeTbody){
    coeFilter.addEventListener('input', function(){
      const v = (this.value||'').trim().toLowerCase();
      Array.from(coeTbody.querySelectorAll('tr')).forEach(tr=>{
        const name = (tr.dataset.coeName || '').toLowerCase();
        tr.style.display = (v==='' || name.includes(v)) ? '' : 'none';
      });
      updateSelectAllState();
    });
  }

  if(selectAll){
    selectAll.addEventListener('change', function(){
      const checked = !!this.checked;
      const visible = Array.from(document.querySelectorAll('#coeTbody tr')).filter(r=>r.style.display!=='none');
      visible.forEach(r => { const cb = r.querySelector('.coe-checkbox'); if(cb) cb.checked = checked; });
    });
  }

  if(mappingClearBtn){
    mappingClearBtn.addEventListener('click', function(){
      document.querySelectorAll('.coe-checkbox').forEach(cb => cb.checked = false);
      const first = document.getElementById('project_choice_new');
      if(first) first.checked = true;
      if(selectAll) selectAll.checked = false;
    });
  }

  function collectSelectedCoes(){ return Array.from(document.querySelectorAll('.coe-checkbox:checked')).map(cb => cb.value); }
  function getSelectedProjectChoice(){ const el = document.querySelector('input[name="project_choice"]:checked'); return el ? el.value : null; }

  if(mappingSaveBtn){
    mappingSaveBtn.addEventListener('click', function(){
      mappingSaveBtn.disabled = true;
      const coeIds = collectSelectedCoes();
      const projectChoice = getSelectedProjectChoice();
      if(!projectChoice){ showStatus('Please select a project.', false); mappingSaveBtn.disabled=false; return; }
      if(coeIds.length === 0){
        if(!confirm('No COEs selected. This will remove mappings for the selected project. Continue?')) { mappingSaveBtn.disabled=false; return; }
      }
      const fd = new FormData();
      fd.append('project_choice', projectChoice);
      coeIds.forEach(id => fd.append('mapped_coe_ids', id));
      if(projectChoice === 'new'){
        const name = (document.getElementById('proj_name_input')||{}).value || '';
        if(!name.trim()){ showStatus('Enter project name before saving mapping for a new project.', false); mappingSaveBtn.disabled=false; return; }
        fd.append('name', name);
        fd.append('description', (document.getElementById('proj_desc_input')||{}).value || '');
        fd.append('start_date', (document.getElementById('proj_start_date')||{}).value || '');
        fd.append('end_date', (document.getElementById('proj_end_date')||{}).value || '');
        fd.append('pdl_username', (document.getElementById('pdl_username')||{}).value || '');
      }

      fetch("{% url 'projects:map_coes' %}", {
        method: 'POST',
        headers: {'X-CSRFToken': csrftoken, 'X-Requested-With': 'XMLHttpRequest'},
        credentials: 'same-origin',
        body: fd
      }).then(r => r.json().catch(()=>null)).then(json=>{
        mappingSaveBtn.disabled = false;
        if(!json){ showStatus('Invalid server response', false); return; }
        if(json.success){
          showStatus('COE mapping saved', true);
          if(window.refreshCoesList) window.refreshCoesList();
          if(window.refreshProjectsList) window.refreshProjectsList();
          if(json.project_id){
            setTimeout(()=>{ window.location.href = "/projects/edit/" + json.project_id + "/"; }, 700);
          }
        } else {
          showStatus(json.error || 'Failed to save mapping', false);
        }
      }).catch(err=>{
        mappingSaveBtn.disabled = false;
        console.error('map_coes fetch error', err);
        showStatus('Server error saving mapping', false);
      });
    });
  }
})();
</script>
{% endblock %}
{% endblock %}
