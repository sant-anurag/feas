{% extends "base.html" %}
{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'projects/css/projects.css' %}">
<link rel="stylesheet" href="{% static 'projects/css/projects-actions.css' %}">
{% endblock %}

{% block content %}
<!-- Outer wrapper kept similar to existing structure to avoid layout regressions -->
<div class="create-wrapper" style="display:flex;gap:28px;align-items:flex-start;flex-wrap:wrap;">

  <!-- LEFT: Create Project FORM -->
  <div class="create-panel" style="flex:0 0 620px;min-width:320px;">
    <div class="panel" style="padding:26px;">
      <h2>Create Project</h2>

      {% if error %}
        <div role="alert" style="color:#b91c1c;margin-bottom:12px;font-weight:700">{{ error }}</div>
      {% endif %}

      <form method="post" class="form-grid" novalidate>
        {% csrf_token %}

        <label>
          <div class="label-title">Project Name</div>
          <input type="text" name="name" required class="form-input" placeholder="Enter project name" />
        </label>

        <label>
          <div class="label-title">Description</div>
          <textarea name="description" rows="4" class="form-input" placeholder="Short description"></textarea>
        </label>

        <div class="form-dates" aria-label="project dates">
          <label>
            <div class="label-title">Start Date</div>
            <input type="date" name="start_date" class="form-input" />
          </label>
          <label>
            <div class="label-title">End Date</div>
            <input type="date" name="end_date" class="form-input" />
          </label>
        </div>

        <label>
          <div class="label-title">Program Development Lead (PDL)</div>
          <input id="pdl_picker" name="pdl_display" type="text" class="form-input"
                 placeholder="Type at least 3 chars to search LDAP..." autocomplete="off" />
          <input id="pdl_username" name="pdl_username" type="hidden" value="" />
          <div id="pdl_suggestions" class="autocomplete-list" aria-hidden="true"></div>
        </label>

        <div class="form-actions">
          <a href="{% url 'projects:list' %}" class="btn secondary" style="text-decoration:none;display:inline-flex;align-items:center;justify-content:center;">Cancel</a>
          <button type="submit" class="btn primary">Create Project</button>
        </div>
      </form>
    </div>
  </div>

  <!-- RIGHT: Action Panel (left layout preserved) -->
  <div class="actions-column" style="flex:1;min-width:360px;">
    <div class="actions-panel" id="actionsPanel">
      <h3>Project Actions</h3>
      <div class="action-buttons">
        <a href="#" class="btn-light" data-open="coeCreateModal">‚ûï Create COE</a>
        <a href="#" class="btn-light" data-open="coeListModal">‚úèÔ∏è Edit COE</a>
        <a href="#" class="btn-light" data-open="coeLeaderModal">üë§ Assign/Edit Leader</a>
        <a href="#" class="btn-light" data-open="domainCreateModal">üìÇ Create Domain</a>
        <a href="#" class="btn-light" data-open="domainEditModal">‚úèÔ∏è Edit Domain</a>
        <a href="{% url 'projects:list' %}" class="btn-light">üìë View Projects</a>
        <a href="#" class="btn-light" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">‚úèÔ∏è Edit Project</a>
        <a href="#" class="btn-light danger" data-open="projectDeleteModal">üóëÔ∏è Delete Project</a>
      </div>
    </div>
  </div>
</div>

<!-- ===== MODALS: keep markup minimal but functional; JS already wires [data-open] and [data-close] ===== -->

<!-- COE Create Modal -->
<div id="coeCreateModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeCreateTitle">
    <div class="modal-header">
      <span id="coeCreateTitle">Create COE</span>
      <button class="close-modal" data-close="coeCreateModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">COE Name</div>
        <input type="text" class="form-input" id="coe_name_input" placeholder="COE Name">
      </label>
      <label>
        <div class="label-title">Description</div>
        <textarea class="form-input" id="coe_desc_input" rows="3" placeholder="Short description"></textarea>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeCreateModal">Cancel</button>
      <button class="btn primary" id="coeCreateSave">Save</button>
    </div>
  </div>
</div>

<!-- COE Edit Modal -->
<div id="coeListModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeEditTitle">
    <div class="modal-header">
      <span id="coeEditTitle">Edit COE</span>
      <button class="close-modal" data-close="coeListModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Select COE</div>
        <select class="form-input" id="coe_select">
          <option value="">-- Select COE --</option>
          <!-- Fill options server side or by AJAX -->
        </select>
      </label>
      <label>
        <div class="label-title">Description</div>
        <textarea class="form-input" id="coe_edit_desc" rows="3"></textarea>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeListModal">Cancel</button>
      <button class="btn primary" id="coeUpdateBtn">Update</button>
    </div>
  </div>
</div>

<!-- Assign/Edit COE Leader Modal -->
<div id="coeLeaderModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="coeLeaderTitle">
    <div class="modal-header">
      <span id="coeLeaderTitle">Assign / Edit COE Leader</span>
      <button class="close-modal" data-close="coeLeaderModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Search User</div>
        <input id="coe_leader_picker" type="text" class="form-input" placeholder="Type at least 3 chars to search LDAP..." autocomplete="off">
        <input id="coe_leader_username" type="hidden">
        <div id="coe_leader_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
      <label>
        <div class="label-title">Select COE</div>
        <select class="form-input" id="coe_for_leader">
          <option value="">-- Select COE --</option>
        </select>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="coeLeaderModal">Cancel</button>
      <button class="btn primary" id="assignCoeLeaderBtn">Assign</button>
    </div>
  </div>
</div>

<!-- Domain Create Modal -->
<div id="domainCreateModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="domainCreateTitle">
    <div class="modal-header">
      <span id="domainCreateTitle">Create Domain</span>
      <button class="close-modal" data-close="domainCreateModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Domain Name</div>
        <input type="text" class="form-input" id="domain_name_input" placeholder="Domain Name">
      </label>
      <label>
        <div class="label-title">Domain Lead (optional)</div>
        <input id="domain_lead_picker" type="text" class="form-input" placeholder="Search user..." autocomplete="off" />
        <input id="domain_lead_username" type="hidden">
        <div id="domain_lead_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="domainCreateModal">Cancel</button>
      <button class="btn primary" id="domainCreateSave">Save</button>
    </div>
  </div>
</div>

<!-- Domain Edit Modal -->
<div id="domainEditModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="domainEditTitle">
    <div class="modal-header">
      <span id="domainEditTitle">Edit Domain</span>
      <button class="close-modal" data-close="domainEditModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <label>
        <div class="label-title">Select Domain</div>
        <select class="form-input" id="domain_select">
          <option value="">-- Select Domain --</option>
        </select>
      </label>
      <label>
        <div class="label-title">Domain Lead</div>
        <input id="domain_edit_lead_picker" class="form-input" placeholder="Search user..." autocomplete="off">
        <input id="domain_edit_lead_username" type="hidden">
        <div id="domain_edit_lead_suggestions" class="autocomplete-list" aria-hidden="true"></div>
      </label>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="domainEditModal">Cancel</button>
      <button class="btn primary" id="domainUpdateBtn">Update</button>
    </div>
  </div>
</div>

<!-- Project Delete Modal -->
<div id="projectDeleteModal" class="modal" aria-hidden="true">
  <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="projectDeleteTitle">
    <div class="modal-header">
      <span id="projectDeleteTitle">Delete Project</span>
      <button class="close-modal" data-close="projectDeleteModal" aria-label="Close modal">&times;</button>
    </div>
    <div class="modal-body">
      <p>Are you sure you want to delete this project? This action cannot be undone.</p>
    </div>
    <div class="modal-footer">
      <button class="btn secondary" data-close="projectDeleteModal">Cancel</button>
      <button class="btn primary danger" id="projectDeleteConfirm">Delete</button>
    </div>
  </div>
</div>

{% block extra_js %}
<script src="{% static 'projects/js/projects-actions.js' %}"></script>

<!-- Optional: small inline helper wiring for modal buttons if you want them to use AJAX later.
     This does not change current functionality. -->
<script>
  // keep handlers minimal to avoid interfering with existing JS
  document.addEventListener('DOMContentLoaded', function() {
    // Example: wire COE Create Save to close modal (no backend call here)
    const coeSave = document.getElementById('coeCreateSave');
    if (coeSave) coeSave.addEventListener('click', function(){ document.querySelector('[data-close="coeCreateModal"]').click(); });

    const projectDeleteConfirm = document.getElementById('projectDeleteConfirm');
    if (projectDeleteConfirm) projectDeleteConfirm.addEventListener('click', function(){
      // default behavior: just close modal ‚Äî developer can attach AJAX call later
      document.querySelector('[data-close="projectDeleteModal"]').click();
    });
  });
</script>
{% endblock %}
{% endblock %}
